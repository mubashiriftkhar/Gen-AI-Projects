<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Legal Tech AI Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{
      margin:0;
      font-family:sans-serif;
      background:#0f172a;
      color:#f1f5f9;
      display:grid;
      grid-template-rows:auto 1fr auto;
      height:100vh;
    }
    /* --- HEADER --- */
    header{
      background:#111827;
      padding:12px 16px;
      border-bottom:1px solid #1f2937;
      display:flex;
      align-items:center;
      gap:10px;
      position:sticky;
      top:0;
      z-index:10;
    }
    header .logo{
      width:34px;
      height:34px;
      border-radius:8px;
      background:linear-gradient(135deg,#3b82f6,#22d3ee);
    }
    header h1{
      font-size:16px;
      margin:0;
      font-weight:600;
    }

    /* --- CHAT --- */
    #chat{padding:20px;overflow-y:auto;display:flex;flex-direction:column;gap:12px}
    .msg{display:flex;gap:10px;align-items:flex-start}
    .avatar{width:50px;height:50px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;flex:0 0 auto}
    .user .avatar{background:#10b981;color:#fff}
    .bot .avatar{background:#3b82f6;color:#fff}
    .bubble{background:#1e293b;padding:12px 14px;border-radius:12px;max-width:80%;line-height:1.5}
    .user .bubble{background:#064e3b}
    .typing{display:inline-flex;gap:6px;padding:6px 0}
    .dot{width:8px;height:8px;border-radius:50%;background:#9ca3af;animation:bounce 1.2s infinite ease-in-out}
    .dot:nth-child(2){animation-delay:.2s}
    .dot:nth-child(3){animation-delay:.4s}
    @keyframes bounce{0%,80%,100%{transform:translateY(0)}40%{transform:translateY(-6px)}}

    /* --- COMPOSER --- */
    form{display:flex;gap:8px;padding:12px;background:#111827;border-top:1px solid #1f2937}
    textarea{flex:1;resize:none;min-height:50px;padding:10px;border-radius:8px;border:1px solid #374151;background:#1f2937;color:#f1f5f9}
    button{padding:0 18px;border:none;border-radius:8px;background:#3b82f6;color:#fff;font-weight:600;cursor:pointer}
  </style>
</head>
<body>
  <!-- HEADER -->
  <header>
    <div class="logo"></div>
    <h1>Legal Tech AI Assistant</h1>
  </header>

  <!-- CHAT -->
  <div id="chat"></div>

  <!-- COMPOSER -->
  <form id="composer">
    <textarea id="prompt" placeholder="Type your question..."></textarea>
    <button type="submit">Send</button>
  </form>

  <script>
  const API_BASE = "http://127.0.0.1:8000"; // FastAPI backend
  const ENDPOINT = "/research";

  const chat = document.getElementById("chat");
  const form = document.getElementById("composer");
  const promptEl = document.getElementById("prompt");

  function addMessage(role, html){
    const wrap = document.createElement("div");
    wrap.className = `msg ${role}`;
    const avatar = document.createElement("div");
    avatar.className = "avatar";
    avatar.textContent = role === "user" ? "You" : "Agent";
    const bubble = document.createElement("div");
    bubble.className = "bubble";
    bubble.innerHTML = html || "";
    wrap.appendChild(avatar);
    wrap.appendChild(bubble);
    chat.appendChild(wrap);
    chat.scrollTop = chat.scrollHeight;
    return bubble;
  }

  function addTypingDots(bubble){
    const dots = document.createElement("div");
    dots.className = "typing";
    for(let i=0;i<3;i++){dots.appendChild(document.createElement("div")).className="dot";}
    bubble.appendChild(dots);
    return ()=>dots.remove();
  }

  async function sendMessage(text){
    addMessage("user", text);
    const botBubble = addMessage("bot", "");
    const stopDots = addTypingDots(botBubble);

    try{
      const res = await fetch(API_BASE+ENDPOINT, {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({ query:text })
      });
      const data = await res.json();
      const html = data.inner_html || "⚠️ No response";

      stopDots();

      // fake token-by-token output
      let i=0;
      const interval = setInterval(()=>{
        botBubble.innerHTML = html.slice(0, i++);
        chat.scrollTop = chat.scrollHeight;
        if(i>html.length) clearInterval(interval);
      }, 20);

    }catch(err){
      stopDots();
      botBubble.innerHTML = `<span style="color:#f59e0b">Error: ${err}</span>`;
    }
  }

  form.addEventListener("submit", (e)=>{
    e.preventDefault();
    const text = promptEl.value.trim();
    if(!text) return;
    promptEl.value="";
    sendMessage(text);
  });
  </script>
</body>
</html>
